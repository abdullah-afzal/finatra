
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>HTTP Requests &#8212; Finatra 24.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/flasky.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="HTTP Responses" href="responses.html" />
    <link rel="prev" title="Defining HTTP Controllers" href="controllers.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="responses.html" title="HTTP Responses"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="controllers.html" title="Defining HTTP Controllers"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User’s Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">HTTP Requests</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <section id="http-requests">
<span id="id1"></span><h1>HTTP Requests<a class="headerlink" href="#http-requests" title="Permalink to this headline">¶</a></h1>
<p>Each Finatra <a class="reference external" href="controllers.html">HTTP Controller</a> route must specify a callback function which is executed
when the defined route matches an incoming request <a class="reference external" href="https://github.com/twitter/finagle/blob/a7867d088ea15620c375bfb5649071c16bc6360a/finagle-base-http/src/main/scala/com/twitter/finagle/http/Method.scala#L24">HTTP method</a> and URI:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">method</span><span class="p">(</span><span class="s">&quot;/URI&quot;</span><span class="p">)(</span><span class="n">callback</span><span class="p">:</span> <span class="nc">T</span> <span class="o">=&gt;</span> <span class="nc">Any</span><span class="p">)</span>
</pre></div>
</div>
<p>The callback function must declare an explicit input type which the framework will attempt to marshal the incoming
Finagle HTTP Request into via the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/internal/routing/CallbackConverter.scala">c.t.finatra.http.intenal.routing.CallbackConverter</a>.</p>
<p>Finatra supports three callback function input types:</p>
<ul class="simple">
<li><p><a class="reference external" href="#finagle-c-t-finagle-http-request">a Finagle HTTP Request</a></p></li>
<li><p>a <a class="reference external" href="#custom-request-case-class">custom “request” case class</a></p></li>
<li><p>or a type <cite>T</cite> parsable by a <a class="reference external" href="#message-body-components">MessageBodyReader[T]</a></p></li>
</ul>
<p>Each are detailed below.</p>
<section id="finagle-c-t-finagle-http-request">
<h2>Finagle <cite>c.t.finagle.http.Request</cite><a class="headerlink" href="#finagle-c-t-finagle-http-request" title="Permalink to this headline">¶</a></h2>
<p>This is a <a class="reference external" href="https://twitter.github.io/finagle/docs/com/twitter/finagle/http/Request.html">c.t.finagle.http.Request</a>
which contains common HTTP attributes.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">Request</span>

<span class="p">...</span>

<span class="n">get</span><span class="p">(</span><span class="s">&quot;/foo&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="nc">Request</span> <span class="o">=&gt;</span>
  <span class="o">???</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="custom-request-case-class">
<h2>Custom “request” case class<a class="headerlink" href="#custom-request-case-class" title="Permalink to this headline">¶</a></h2>
<p>Custom “request” case classes can be used for declarative parsing of HTTP requests with deep support for JSON body parsing,
type conversions, default values, and <a class="reference external" href="../json/validations.html">validations</a>.</p>
<p>Note, that the case class represents a <em>model</em> of your HTTP request but is not an actual Finagle HTTP Request. Also note
that when using a custom “request” case class, you can still <a class="reference external" href="#accessing-the-underlying-finagle-http-request">access and use the actual underlying Finagle HTTP request</a>.</p>
<p>The case class field names should match the request or header parameter name or should use the <a class="reference external" href="https://github.com/FasterXML/jackson-annotations#annotations-for-renaming-properties">&#64;JsonProperty</a>
annotation to specify the expected JSON field name in the request body (see: <a class="reference external" href="https://github.com/twitter/finatra/blob/c6e4716f082c0c8790d06d9e1664aacbd0c3fede/jackson/src/test/scala/com/twitter/finatra/json/tests/internal/ExampleCaseClasses.scala#L177">example</a>
and <a class="reference external" href="https://github.com/twitter/finatra/blob/01fdd9cfb3c877fe226085bf411f42ae08420e5d/jackson/src/test/scala/com/twitter/finatra/jackson/tests/AbstractScalaObjectMapperTest.scala#L283">test case</a>).</p>
<p>A <a class="reference external" href="https://fasterxml.github.io/jackson-databind/javadoc/2.3.0/com/fasterxml/jackson/databind/PropertyNamingStrategy.html">PropertyNamingStrategy</a>
can be configured to handle common name substitutions (e.g. <cite>snake_case</cite> or <cite>camelCase</cite>). By default,
<cite>snake_case</cite> is used (defaults are set by the <cite>ScalaObjectMapper</cite> provided by the <a class="reference external" href="https://github.com/twitter/finatra/tree/master/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala">ScalaObjectMapperModule</a>).</p>
<p>For example, if we have a <cite>POST</cite> endpoint which expects a JSON body with a <cite>Long</cite> <cite>“id”</cite> and a
<cite>String</cite> <cite>“name”</cite>, we could define the following case class and Controller route:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">HiRequest</span><span class="p">(</span><span class="n">id</span><span class="p">:</span> <span class="nc">Long</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>

<span class="p">...</span>

<span class="n">post</span><span class="p">(</span><span class="s">&quot;/hi&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">hiRequest</span><span class="p">:</span> <span class="nc">HiRequest</span> <span class="o">=&gt;</span>
  <span class="s">&quot;Hello &quot;</span> <span class="o">+</span> <span class="n">hiRequest</span><span class="p">.</span><span class="n">name</span> <span class="o">+</span> <span class="s">&quot; with id &quot;</span> <span class="o">+</span> <span class="n">hiRequest</span><span class="p">.</span><span class="n">id</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For the request: <code class="docutils literal notranslate"><span class="pre">POST</span> <span class="pre">/hi</span></code></p>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;id&quot;</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"></span>
<span class="w">  </span><span class="nt">&quot;name&quot;</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Bob&quot;</span><span class="w"></span>
<span class="p">}</span><span class="w"></span>
</pre></div>
</div>
<p>The incoming request body will be parsed as JSON using the configured <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a>
into the <cite>HiRequest</cite> case class. This route would thus return:</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">statuscode 200</dt>
<dd class="field-odd"><p><cite>Hello Bob with id 1</cite></p>
</dd>
</dl>
</div></blockquote>
<p>More examples in the <a class="reference external" href="../json/routing.html#json-integration-with-routing">JSON Integration with Routing</a>
section.</p>
<p>For more information on configuring the <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> see the
<a class="reference external" href="../json/index.html">Jackson Integration</a> section.</p>
<section id="required-fields">
<h3>Required Fields<a class="headerlink" href="#required-fields" title="Permalink to this headline">¶</a></h3>
<p><strong>Non-option fields without default values are considered required.</strong></p>
<p>If a required field is missing, a <cite>CaseClassMappingException</cite> is thrown.</p>
</section>
<section id="field-annotations">
<h3>Field Annotations<a class="headerlink" href="#field-annotations" title="Permalink to this headline">¶</a></h3>
<p>Field annotations are for parsing case class fields that do not come from the incoming
request body and tell the framework how to parse the case class member from the incoming
the <cite>c.t.finagle.http.Request</cite>. These annotations are implemented via a Finatra HTTP integration
with Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/InjectableValues.java">InjectableValues</a>
implemented in the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/marshalling/MessageInjectableValues.scala">MessageInjectableValues</a> class.</p>
<p>Supported annotations:</p>
<ul class="simple">
<li><p><a class="reference external" href="#routeparam">&#64;RouteParam</a></p></li>
<li><p><a class="reference external" href="#queryparam">&#64;QueryParam</a></p></li>
<li><p><a class="reference external" href="#formparam">&#64;FormParam</a></p></li>
<li><p><a class="reference external" href="#header">&#64;Header</a></p></li>
<li><p><a class="reference external" href="#javax-inject-inject">&#64;javax.inject.Inject</a> (allows for injection of a instance from the object graph).</p></li>
</ul>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/marshalling/MessageInjectableValues.scala">MessageInjectableValues</a>
is only configured via the framework’s <a class="reference external" href="./message_body.html#id2">DefaultMessageBodyReader</a>
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/marshalling/DefaultMessageBodyReaderImpl.scala">DefaultMessageBodyReaderImpl</a>
which is bound in the <a class="reference external" href="./message_body.html#id5">MessageBodyModule</a>.</p>
<p>Thus, attempting to use the HTTP-specific field annotations with a <a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a>
instance <strong>will not work</strong>.</p>
<p>That is, trying to deserialize JSON into a case class that has fields annotated with
<cite>&#64;QueryParam</cite>, <cite>&#64;RouteParam</cite>, <cite>&#64;FormParam</cite> or <cite>&#64;Header</cite> with an instance of the
<a class="reference external" href="https://github.com/twitter/util/blob/develop/util-jackson/src/main/scala/com/twitter/util/jackson/ScalaObjectMapper.scala"><cite>ScalaObjectMapper</cite></a> will not properly inject those fields from a given HTTP message.</p>
<p>This injection will only happen properly through usage of the Finatra framework’s
<a class="reference external" href="./message_body.html#id2">DefaultMessageBodyReader#parse</a>.</p>
</div>
<hr class="docutils" />
<section id="routeparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/RouteParam.java">&#64;RouteParam</a><a class="headerlink" href="#routeparam" title="Permalink to this headline">¶</a></h4>
<p>Denotes a field to be parsed from a named parameter in a given route, e.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">FromRouteRequest</span><span class="p">(</span>
  <span class="nd">@RouteParam</span><span class="p">(</span><span class="s">&quot;entity&quot;</span><span class="p">)</span> <span class="n">resource</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
  <span class="nd">@RouteParam</span> <span class="n">id</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>


<span class="n">get</span><span class="p">(</span><span class="s">&quot;/foo/:entity/:id&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="nc">FromRouteRequest</span> <span class="o">=&gt;</span>
  <span class="s">s&quot;The resource is </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="n">resource</span><span class="si">}</span><span class="s"> and the id = </span><span class="si">${</span><span class="n">request</span><span class="p">.</span><span class="n">id</span><span class="si">}</span><span class="s">&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Given a request: <code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/foo/users/1234</span></code></p>
<p>Using <cite>FromRouteRequest</cite> as an input to the route callback would parse the string “users” into the
value of <cite>FromRouteRequest#resource</cite> and the string “1234” into the value of <cite>FromRouteRequest#id</cite>.</p>
<p>Thus, this route would respond:</p>
<blockquote>
<div><dl class="field-list simple">
<dt class="field-odd">statuscode 200</dt>
<dd class="field-odd"><p><cite>The resource is users and the id = 1234</cite></p>
</dd>
</dl>
</div></blockquote>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/IdAndNameRequest.scala">example</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Route parameter names are case sensitive.</p>
</div>
</section>
<hr class="docutils" />
<section id="queryparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/QueryParam.java">&#64;QueryParam</a><a class="headerlink" href="#queryparam" title="Permalink to this headline">¶</a></h4>
<p>Read a value from the request query string by a parameter named for the case class field or by the
<code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code> annotation value.</p>
<p>For example, suppose you want to parse a <cite>GET</cite> request with three query params: <cite>max</cite>, <cite>startDate</cite>,
and <cite>verbose</cite>, e.g.,</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/users?max=10&amp;start_date=2014-05-30TZ&amp;verbose=true</span></code></p>
<p>This can be modeled with the following custom “request” case class which also applies
<a class="reference external" href="../json/validations.html">validations</a>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">UsersRequest</span><span class="p">(</span>
  <span class="nd">@Max</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span> <span class="nd">@QueryParam</span> <span class="n">max</span><span class="p">:</span> <span class="nc">Int</span><span class="p">,</span>
  <span class="nd">@PastDate</span> <span class="nd">@QueryParam</span> <span class="n">startDate</span><span class="p">:</span> <span class="nc">Option</span><span class="p">[</span><span class="nc">DateTime</span><span class="p">],</span>
  <span class="nd">@QueryParam</span> <span class="n">verbose</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="p">)</span>

<span class="n">get</span><span class="p">(</span><span class="s">&quot;/users&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="nc">UsersRequest</span> <span class="o">=&gt;</span>
  <span class="o">???</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <cite>max</cite> value will be parsed into an <cite>Int</cite> and <a class="reference external" href="https://github.com/twitter/finatra/blob/c6e4716f082c0c8790d06d9e1664aacbd0c3fede/jackson/src/main/scala/com/twitter/finatra/json/internal/caseclass/validation/validators/MaxValidator.scala#L49">validated to be less than or equal to
100</a>.
The <cite>startDate</cite> will be parsed into an <cite>Option[DateTime]</cite> (meaning it could be omitted without error
from the query string) and if present will be validated to be a date in the past. Lastly, the
<cite>verbose</cite> parameter will be parsed into a <cite>Boolean</cite> type.</p>
<p>You can also set the parameter name as a value in the <code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code> annotation, e.g.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">QueryParamRequest</span><span class="p">(</span>
  <span class="nd">@QueryParam</span> <span class="n">foo</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
  <span class="nd">@QueryParam</span><span class="p">(</span><span class="s">&quot;skip&quot;</span><span class="p">)</span> <span class="n">isSkipped</span><span class="p">:</span> <span class="nc">Boolean</span><span class="p">)</span>
</pre></div>
</div>
<p>Using this case class in a route callback for a request:</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/?foo=bar&amp;skip=false</span></code></p>
<p>would parse the string “bar” into the value of <cite>QueryParamRequest#foo</cite> and parse the string “false”
as a Boolean into the <cite>QueryParamRequest#isSkipped</cite> field.</p>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/RequestWithQueryParamSeqString.scala">example</a>.</p>
<p>You can parse comma-separated lists in your query parameters by setting <cite>commaSeparatedList</cite> to <cite>true</cite> in the QueryParam annotation, e.g.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">case</span> <span class="k">class</span> <span class="nc">ManyUsersRequest</span><span class="p">(</span>
  <span class="nd">@QueryParam</span><span class="p">(</span><span class="n">commaSeparatedList</span><span class="o">=</span><span class="kc">true</span><span class="p">)</span> <span class="n">ids</span><span class="p">:</span> <span class="nc">Seq</span><span class="p">[</span><span class="nc">Long</span><span class="p">])</span>
</pre></div>
</div>
<p>Using this class in a route callback for a request:</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/?ids=1,2,3</span></code></p>
<p>would split the string “1,2,3” into “1”, “2”, and “3”, and then parse each into a <cite>Long</cite>.</p>
<p>Note that turning this on will disallow repeating the ‘ids’ parameter, ie.</p>
<p><code class="docutils literal notranslate"><span class="pre">GET</span> <span class="pre">/?ids=1&amp;ids=2,3</span></code></p>
<p>will return a Bad Request with an appropriate error message when <cite>commaSeparatedList</cite> is <cite>true</cite>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Query parameter names are case sensitive.</p>
</div>
</section>
<hr class="docutils" />
<section id="formparam">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/FormParam.java">&#64;FormParam</a><a class="headerlink" href="#formparam" title="Permalink to this headline">¶</a></h4>
<p>Read a value from a form field with the case class field’s name or as the value specified in the
<code class="docutils literal notranslate"><span class="pre">&#64;FormParam</span></code> annotation from the request body.</p>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/FormPostRequest.scala">example</a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Form parameter names are case sensitive.</p>
</div>
</section>
<hr class="docutils" />
<section id="header">
<h4><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-annotations/src/main/java/com/twitter/finatra/http/annotations/Header.java">&#64;Header</a><a class="headerlink" href="#header" title="Permalink to this headline">¶</a></h4>
<p>Read a header value specified by the case class field name or by the <code class="docutils literal notranslate"><span class="pre">&#64;Header</span></code> annotation value.
You can use a Scala <a class="reference external" href="https://www.scala-lang.org/files/archive/spec/2.11/01-lexical-syntax.html">“back-quote” literal</a>
for the field name when special characters are involved.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@Header</span> <span class="n">`user-agent`</span><span class="p">:</span> <span class="nc">String</span>
</pre></div>
</div>
<p>or specify the header name as a parameter to the <code class="docutils literal notranslate"><span class="pre">&#64;Header</span></code> annotation, e.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@Header</span><span class="p">(</span><span class="s">&quot;user-agent&quot;</span><span class="p">)</span> <span class="n">agent</span><span class="p">:</span> <span class="nc">String</span>
</pre></div>
</div>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/CreateUserRequest.scala">example</a>.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>Route, query, and form params are all stored in the “params” field of the incoming Finagle http
request. As such, you should ensure that <code class="docutils literal notranslate"><span class="pre">&#64;RouteParam</span></code> names do not collide with <code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code>
names. Otherwise, an <code class="docutils literal notranslate"><span class="pre">&#64;QueryParam</span></code> could end up parsing an <code class="docutils literal notranslate"><span class="pre">&#64;RouteParam</span></code> or <code class="docutils literal notranslate"><span class="pre">&#64;FormParam</span></code>
field.</p>
<p>Also note that headers are accessed <strong>case-insensitively</strong>. Thus, the annotated fields:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="nd">@Header</span><span class="p">(</span><span class="s">&quot;Accept-Charset&quot;</span><span class="p">)</span> <span class="n">acceptCharset</span><span class="p">:</span> <span class="nc">String</span>
<span class="nd">@Header</span><span class="p">(</span><span class="s">&quot;accept-charset&quot;</span><span class="p">)</span> <span class="n">acceptCharset</span><span class="p">:</span> <span class="nc">String</span>
<span class="nd">@Header</span><span class="p">(</span><span class="s">&quot;aCcEpT-cHaRsEt&quot;</span><span class="p">)</span> <span class="n">acceptCharset</span><span class="p">:</span> <span class="nc">String</span>
<span class="nd">@Header</span> <span class="n">`accept-charset`</span><span class="p">:</span> <span class="nc">String</span>
</pre></div>
</div>
<p>would all retrieve <strong>the same value</strong> from the request headers map.</p>
</div>
</section>
<hr class="docutils" />
<section id="javax-inject-inject">
<h4>&#64;javax.inject.Inject<a class="headerlink" href="#javax-inject-inject" title="Permalink to this headline">¶</a></h4>
<p>Can be used to inject any <a class="reference external" href="https://github.com/google/guice">Guice</a> managed class into your case
class.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">javax</span><span class="p">.</span><span class="nn">inject</span><span class="p">.</span><span class="nc">Inject</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">InjectedFieldCaseClass</span><span class="p">(</span>
  <span class="nd">@Inject</span> <span class="n">bar</span><span class="p">:</span> <span class="nc">Bar</span><span class="p">,</span>
  <span class="nd">@Inject</span> <span class="n">foo</span> <span class="nc">Foo</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that we use <cite>&#64;javax.inject.Inject</cite> here but as mentioned in the
<a class="reference external" href="../json/index.html#jackson-injectablevalues-support">Jackson InjectableValues Support</a> documention,
<cite>com.google.inject.Inject</cite> or <cite>com.fasterxml.jackson.annotation.JacksonInject</cite> are also supported
annotations for injecting fields via Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/InjectableValues.java">InjectableValues</a>.</p>
<p>Code <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/domain/RequestWithInjections.scala">example</a>.</p>
<section id="accessing-the-underlying-finagle-http-request">
<h5>Accessing the Underlying Finagle HTTP Request<a class="headerlink" href="#accessing-the-underlying-finagle-http-request" title="Permalink to this headline">¶</a></h5>
<p>It is not necessary to <cite>&#64;Inject</cite> the underlying Finagle HTTP Request into your
case class. The framework <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/marshalling/MessageInjectableValues.scala">MessageInjectableValues</a> specifically knows how to “inject”
the current Finagle HTTP Request into a case class during request parsing.</p>
<p>Thus, to access the underlying Finagle HTTP Request in your custom “request” case class, include
a field of type <cite>c.t.finagle.http.Request</cite> and the framework will properly inject the incoming
Finagle HTTP Request into your custom case class, for example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">Request</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">annotations</span><span class="p">.</span><span class="nc">Header</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">annotations</span><span class="p">.</span><span class="nc">QueryParam</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">CaseClassWithRequestField</span><span class="p">(</span>
 <span class="nd">@Header</span><span class="p">(</span><span class="s">&quot;user-agent&quot;</span><span class="p">)</span> <span class="n">agent</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
 <span class="nd">@QueryParam</span> <span class="n">verbose</span><span class="p">:</span> <span class="nc">Boolean</span> <span class="o">=</span> <span class="kc">false</span><span class="p">,</span>
 <span class="n">request</span><span class="p">:</span> <span class="nc">Request</span><span class="p">)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/marshalling/MessageInjectableValues.scala">MessageInjectableValues</a> is doing the work to provide the Finagle HTTP Request
as context in a Jackson <a class="reference external" href="https://github.com/FasterXML/jackson-databind/blob/master/src/main/java/com/fasterxml/jackson/databind/InjectableValues.java">InjectableValues</a> implementation that can be used for object mapping the incoming Finagle HTTP Request.</p>
<p>Because the current Finagle HTTP Request is necessary, the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/marshalling/MessageInjectableValues.scala">MessageInjectableValues</a>
is only available via the <a class="reference external" href="./message_body.html#id2">DefaultMessageBodyReader#parse</a> which expects a Finagle HTTP <a class="reference external" href="https://github.com/twitter/finagle/blob/develop/finagle-base-http/src/main/scala/com/twitter/finagle/http/Message.scala">c.t.finagle.http.Message</a> (and not as part of the ScalaObjectMapper – which knows nothing about HTTP).</p>
</div>
</section>
</section>
<section id="do-not-use-multiple-field-annotations">
<h4>Do Not Use Multiple Field Annotations<a class="headerlink" href="#do-not-use-multiple-field-annotations" title="Permalink to this headline">¶</a></h4>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>It is an error to specify multiple field annotations on a single case class field, and it is also an
error to use a field annotation in conjunction with <strong>any</strong> <a class="reference external" href="https://github.com/FasterXML/jackson-annotations/blob/a991c43a74e4230eb643e380870b503997674c2d/src/main/java/com/fasterxml/jackson/annotation/JacksonAnnotation.java#L9">JacksonAnnotation</a>.</p>
<p>Both of these cases will result in error during deserialization of JSON into the case class.</p>
</div>
</section>
</section>
<section id="disable-automatic-request-body-parsing">
<h3>Disable Automatic Request Body Parsing<a class="headerlink" href="#disable-automatic-request-body-parsing" title="Permalink to this headline">¶</a></h3>
<p>When a Controller route callback is specified to use a custom “request” case class as the callback
input type, any incoming request with a <cite>Content-Type</cite> of <cite>application/json</cite> with trigger the framework
to parse the incoming Finagle HTTP Request body as JSON in order to convert into the custom “request”
case class.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">annotations</span><span class="p">.</span><span class="nc">Header</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">annotations</span><span class="p">.</span><span class="nc">RouteParam</span>

<span class="k">case</span> <span class="k">class</span> <span class="nc">MyGreatCaseClass</span><span class="p">(</span>
 <span class="nd">@Header</span><span class="p">(</span><span class="s">&quot;user-agent&quot;</span><span class="p">)</span> <span class="n">agent</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
 <span class="nd">@RouteParam</span> <span class="n">id</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>

<span class="p">...</span>

<span class="n">post</span><span class="p">(</span><span class="s">&quot;/foo/:id&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="nc">MyGreatCaseClass</span> <span class="o">=&gt;</span>
  <span class="o">???</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In the above example if the HTTP request is sent with a <cite>Content-Type</cite> header of <cite>application/json</cite>,
the framework will try to parse the incoming request body as JSON. There is no need to have the
framework attempt to read the request body as JSON to map it to the <cite>MyGreatCaseClass</cite> case class
since none of the custom “request” case class fields come from the request body.</p>
<p>In cases like this, the automatic request body parsing behavior can be disabled by annotating the
custom “request” case class with <code class="docutils literal notranslate"><span class="pre">&#64;JsonIgnoreBody</span></code>.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span> <span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">annotations</span><span class="p">.</span><span class="nc">Header</span>
 <span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">annotations</span><span class="p">.</span><span class="nc">JsonIgnoreBody</span>
 <span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">annotations</span><span class="p">.</span><span class="nc">RouteParam</span>

<span class="hll"> <span class="nd">@JsonIgnoreBody</span>
</span> <span class="k">case</span> <span class="k">class</span> <span class="nc">MyGreatCaseClass</span><span class="p">(</span>
  <span class="nd">@Header</span><span class="p">(</span><span class="s">&quot;user-agent&quot;</span><span class="p">)</span> <span class="n">agent</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
  <span class="nd">@RouteParam</span> <span class="n">id</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span>
</pre></div>
</div>
<p>If necessary, you can access the request body (or any other attribute) directly from the
Finagle HTTP Request by adding a member of type <cite>c.t.finagle.http.Request</cite> as mentioned above in the
<a class="reference external" href="#accessing-the-underlying-finagle-http-request">Accessing the Underlying Finagle HTTP Request</a> section.</p>
</section>
</section>
<section id="message-body-components">
<h2>Message Body Components<a class="headerlink" href="#message-body-components" title="Permalink to this headline">¶</a></h2>
<p>Finatra also provides a more general way to specify how to marhsal the incoming Finagle HTTP Request into
a callback function input type <cite>T</cite> using a <a class="reference external" href="message_body.html#message-body-readers">MessageBodyReader[T]</a>.</p>
<p>Similar to <a class="reference external" href="#custom-request-case-class">custom “request” case classes</a> – which are supported via the framework
<a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/marshalling/DefaultMessageBodyReaderImpl.scala">DefaultMessageBodyReader</a> implementation, message body readers allow for customized parsing of
the full incoming <cite>c.t.finagle.http.Request</cite> into a specific type, <cite>T</cite>.</p>
<p>For more information, see the <a class="reference external" href="./message_body.html#messagebodyreader-t">MessageBodyReader[T]</a>
section of the <a class="reference external" href="./message_body.html">Message Body Components</a> documentation.</p>
</section>
<section id="request-forwarding">
<h2>Request Forwarding<a class="headerlink" href="#request-forwarding" title="Permalink to this headline">¶</a></h2>
<p>You can forward a request to another controller. This is similar to other frameworks where
forwarding will re-use the same request as opposed to issuing a redirect which will force a client
to issue a new request.</p>
<p>To forward, you need to include a <cite>c.t.finatra.http.request.HttpForward</cite> instance in your controller,
e.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">Request</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">Controller</span>

<span class="k">class</span> <span class="nc">MyController</span> <span class="nd">@Inject</span><span class="p">()(</span>
  <span class="n">forward</span><span class="p">:</span> <span class="nc">HttpForward</span><span class="p">)</span>
  <span class="k">extends</span> <span class="nc">Controller</span> <span class="p">{</span>
</pre></div>
</div>
<p>Then, to use in your route:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/foo&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="nc">Request</span> <span class="o">=&gt;</span>
  <span class="n">forward</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s">&quot;/bar&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Forwarded requests will bypass the server defined filter chain (as the requests have already passed
through the filter chain) but will still pass through controller defined filters.</p>
<p>For example, if a route is defined:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">filter</span><span class="p">[</span><span class="nc">MyAwesomeFilter</span><span class="p">].</span><span class="n">get</span><span class="p">(</span><span class="s">&quot;/bar&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="nc">Request</span> <span class="o">=&gt;</span>
  <span class="s">&quot;Hello, world.&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When another controller forwards to this route, <cite>MyAwesomeFilter</cite> will be executed on the forwarded
request.</p>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>By default Finatra sets a maximum forward depth of 5. This value is configurable by setting the
<cite>HttpRouter#withMaxRequestForwardingDepth</cite>. This helps prevent a given request from being
forwarded in an infinite loop.</p>
<p>In the example below, the server has been setup to allow a request to forward a maximum of 10 times.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">router</span>
    <span class="p">.</span><span class="n">withMaxRequestForwardingDepth</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
    <span class="p">.</span><span class="n">add</span><span class="p">[</span><span class="nc">MyController</span><span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</section>
<section id="multipart-requests">
<h2>Multipart Requests<a class="headerlink" href="#multipart-requests" title="Permalink to this headline">¶</a></h2>
<p>Finatra has support for multi-part requests. Here’s an example of a multi-part <cite>POST</cite> controller
route definition that simply returns all of the keys in the multi-part request:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">post</span><span class="p">(</span><span class="s">&quot;/multipartParamsEcho&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">request</span><span class="p">:</span> <span class="nc">Request</span> <span class="o">=&gt;</span>
  <span class="nc">RequestUtils</span><span class="p">.</span><span class="n">multiParams</span><span class="p">(</span><span class="n">request</span><span class="p">).</span><span class="n">keys</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An example of testing this endpoint:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">deserializeRequest</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="o">=</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="n">requestBytes</span> <span class="o">=</span> <span class="nc">IOUtils</span><span class="p">.</span><span class="n">toByteArray</span><span class="p">(</span><span class="n">getClass</span><span class="p">.</span><span class="n">getResourceAsStream</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
  <span class="nc">HttpCodec</span><span class="p">.</span><span class="n">decodeBytesToRequest</span><span class="p">(</span><span class="n">requestBytes</span><span class="p">)</span>
<span class="p">}</span>

<span class="s">&quot;post multipart&quot;</span> <span class="n">in</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="n">request</span> <span class="o">=</span> <span class="n">deserializeRequest</span><span class="p">(</span><span class="s">&quot;/multipart/request-POST-android.bytes&quot;</span><span class="p">)</span>
  <span class="n">request</span><span class="p">.</span><span class="n">uri</span> <span class="o">=</span> <span class="s">&quot;/multipartParamsEcho&quot;</span>

  <span class="n">server</span><span class="p">.</span><span class="n">httpRequest</span><span class="p">(</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span>
    <span class="n">suppress</span> <span class="o">=</span> <span class="kc">true</span><span class="p">,</span>
    <span class="n">andExpect</span> <span class="o">=</span> <span class="nc">Ok</span><span class="p">,</span>
    <span class="n">withJsonBody</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;[&quot;banner&quot;]&quot;&quot;&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
<section id="json-patch-requests">
<h2>JSON Patch Requests<a class="headerlink" href="#json-patch-requests" title="Permalink to this headline">¶</a></h2>
<p>Finatra has support for JSON Patch requests, see <a class="reference external" href="https://tools.ietf.org/html/rfc6902">JSON Patch definition</a>.</p>
<p>To handle JSON Patch requests, you will first need to register the <cite>JsonPatchMessageBodyReader</cite> and
the <cite>JsonPatchExceptionMapper</cite> in the server. The <cite>JsonPatchMessageBodyReader</cite> is for parsing JSON
Patch requests as type <cite>c.t.finatra.http.jsonpatch.JsonPatch</cite>, and <cite>JsonPatchExceptionMapper</cite> can
convert JsonPatchExceptions to HTTP responses.</p>
<p>See <a class="reference external" href="exceptions.html">Add an ExceptionMapper</a> for more information on exception mappers.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

 <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
   <span class="n">router</span>
     <span class="p">.</span><span class="n">register</span><span class="p">[</span><span class="nc">JsonPatchMessageBodyReader</span><span class="p">]</span>
     <span class="p">.</span><span class="n">exceptionMapper</span><span class="p">[</span><span class="nc">JsonPatchExceptionMapper</span><span class="p">]</span>
     <span class="p">.</span><span class="n">add</span><span class="p">[</span><span class="nc">ExampleController</span><span class="p">]</span>
 <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Next, you should include a <cite>c.t.finatra.http.jsonpatch.JsonPatchOperator</cite> instance in your controller,
which provides <cite>JsonPatchOperator#toJsonNode</cite> conversions and support for all JSON Patch operations.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">Controller</span>

<span class="k">class</span> <span class="nc">MyController</span> <span class="nd">@Inject</span><span class="p">()(</span>
  <span class="n">jsonPatchOperator</span><span class="p">:</span> <span class="nc">JsonPatchOperator</span>
<span class="p">)</span> <span class="k">extends</span> <span class="nc">Controller</span> <span class="p">{</span>
  <span class="o">???</span>
<span class="p">}</span>
</pre></div>
</div>
<p>After the target data has been converted to a JsonNode, just call <cite>JsonPatchUtility.operate</cite> to apply
JSON Patch operations to the target.</p>
<p>For example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="n">patch</span><span class="p">(</span><span class="s">&quot;/jsonPatch&quot;</span><span class="p">)</span> <span class="p">{</span> <span class="n">jsonPatch</span><span class="p">:</span> <span class="nc">JsonPatch</span> <span class="o">=&gt;</span>
  <span class="kd">val</span> <span class="n">testCase</span> <span class="o">=</span> <span class="nc">ExampleCaseClass</span><span class="p">(</span><span class="s">&quot;world&quot;</span><span class="p">)</span>
  <span class="kd">val</span> <span class="n">originalJson</span> <span class="o">=</span> <span class="n">jsonPatchOperator</span><span class="p">.</span><span class="n">toJsonNode</span><span class="p">[</span><span class="nc">ExampleCaseClass</span><span class="p">](</span><span class="n">testCase</span><span class="p">)</span>
  <span class="nc">JsonPatchUtility</span><span class="p">.</span><span class="n">operate</span><span class="p">(</span><span class="n">jsonPatch</span><span class="p">.</span><span class="n">patches</span><span class="p">,</span> <span class="n">jsonPatchOperator</span><span class="p">,</span> <span class="n">originalJson</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>An example of testing this endpoint:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="s">&quot;JsonPatch&quot;</span> <span class="n">in</span> <span class="p">{</span>
  <span class="kd">val</span> <span class="n">request</span> <span class="o">=</span> <span class="nc">RequestBuilder</span><span class="p">.</span><span class="n">patch</span><span class="p">(</span><span class="s">&quot;/jsonPatch&quot;</span><span class="p">)</span>
    <span class="p">.</span><span class="n">body</span><span class="p">(</span>
      <span class="s">&quot;&quot;&quot;[</span>
<span class="s">        |{&quot;op&quot;:&quot;add&quot;,&quot;path&quot;:&quot;/fruit&quot;,&quot;value&quot;:&quot;orange&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;remove&quot;,&quot;path&quot;:&quot;/hello&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;copy&quot;,&quot;from&quot;:&quot;/fruit&quot;,&quot;path&quot;:&quot;/veggie&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;replace&quot;,&quot;path&quot;:&quot;/veggie&quot;,&quot;value&quot;:&quot;bean&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;move&quot;,&quot;from&quot;:&quot;/fruit&quot;,&quot;path&quot;:&quot;/food&quot;},</span>
<span class="s">        |{&quot;op&quot;:&quot;test&quot;,&quot;path&quot;:&quot;/food&quot;,&quot;value&quot;:&quot;orange&quot;}</span>
<span class="s">        |]&quot;&quot;&quot;</span><span class="p">.</span><span class="n">stripMargin</span><span class="p">,</span>
      <span class="n">contentType</span> <span class="o">=</span> <span class="nc">Message</span><span class="p">.</span><span class="nc">ContentTypeJsonPatch</span><span class="p">)</span>

  <span class="n">server</span><span class="p">.</span><span class="n">httpRequestJson</span><span class="p">[</span><span class="nc">JsonNode</span><span class="p">](</span>
    <span class="n">request</span> <span class="o">=</span> <span class="n">request</span><span class="p">,</span>
    <span class="n">andExpect</span> <span class="o">=</span> <span class="nc">Ok</span><span class="p">,</span>
    <span class="n">withJsonBody</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;{&quot;food&quot;:&quot;orange&quot;,&quot;veggie&quot;:&quot;bean&quot;}&quot;&quot;&quot;</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information and examples, see:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/request/RequestUtils.scala">c.t.finatra.http.request.RequestUtils</a></p></li>
<li><p><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-core/src/main/scala/com/twitter/finatra/http/fileupload/MultipartItem.scala">c.t.finatra.http.fileupload.MultipartItem</a></p></li>
<li><p><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/main/controllers/DoEverythingController.scala">DoEverythingController</a></p></li>
<li><p><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/integration/doeverything/test/DoEverythingServerFeatureTest.scala">DoEverythingServerFeatureTest</a></p></li>
<li><p><a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/test/scala/com/twitter/finatra/http/tests/request/MultiParamsTest.scala">MultiParamsTest</a></p></li>
</ul>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTTP Requests</a><ul>
<li><a class="reference internal" href="#finagle-c-t-finagle-http-request">Finagle <cite>c.t.finagle.http.Request</cite></a></li>
<li><a class="reference internal" href="#custom-request-case-class">Custom “request” case class</a><ul>
<li><a class="reference internal" href="#required-fields">Required Fields</a></li>
<li><a class="reference internal" href="#field-annotations">Field Annotations</a><ul>
<li><a class="reference internal" href="#routeparam">&#64;RouteParam</a></li>
<li><a class="reference internal" href="#queryparam">&#64;QueryParam</a></li>
<li><a class="reference internal" href="#formparam">&#64;FormParam</a></li>
<li><a class="reference internal" href="#header">&#64;Header</a></li>
<li><a class="reference internal" href="#javax-inject-inject">&#64;javax.inject.Inject</a><ul>
<li><a class="reference internal" href="#accessing-the-underlying-finagle-http-request">Accessing the Underlying Finagle HTTP Request</a></li>
</ul>
</li>
<li><a class="reference internal" href="#do-not-use-multiple-field-annotations">Do Not Use Multiple Field Annotations</a></li>
</ul>
</li>
<li><a class="reference internal" href="#disable-automatic-request-body-parsing">Disable Automatic Request Body Parsing</a></li>
</ul>
</li>
<li><a class="reference internal" href="#message-body-components">Message Body Components</a></li>
<li><a class="reference internal" href="#request-forwarding">Request Forwarding</a></li>
<li><a class="reference internal" href="#multipart-requests">Multipart Requests</a></li>
<li><a class="reference internal" href="#json-patch-requests">JSON Patch Requests</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User’s Guide</a><ul>
      <li>Previous: <a href="controllers.html" title="previous chapter">Defining HTTP Controllers</a></li>
      <li>Next: <a href="responses.html" title="next chapter">HTTP Responses</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2024 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>