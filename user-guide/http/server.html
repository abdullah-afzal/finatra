
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>HTTP Server Definition &#8212; Finatra 24.2.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/flasky.css" />
    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Defining HTTP Controllers" href="controllers.html" />
    <link rel="prev" title="How to properly configure the server StatsReceiver" href="../twitter-server/stats_receiver.html" />
   
  
  <link media="only screen and (max-device-width: 480px)" href="../../_static/small_flask.css" type= "text/css" rel="stylesheet" />
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-39101739-4', 'twitter.github.io');
    ga('send', 'pageview');

  </script>

  </head><body>
  
  

    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="controllers.html" title="Defining HTTP Controllers"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../twitter-server/stats_receiver.html" title="How to properly configure the server StatsReceiver"
             accesskey="P">previous</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">Finatra</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">User’s Guide</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">HTTP Server Definition</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <p id="http-server">Note: the most up-to-date examples are located in the <a class="reference external" href="https://github.com/twitter/finatra/tree/master/examples">finatra/examples</a> project.</p>
<p>See <a class="reference external" href="https://github.com/twitter/finatra/tree/develop/examples/http-server">examples/http-server</a> for a simple example HTTP Server.</p>
<section id="http-server-definition">
<h1>HTTP Server Definition<a class="headerlink" href="#http-server-definition" title="Permalink to this headline">¶</a></h1>
<p>To start, add a dependency on the <a class="reference external" href="https://search.maven.org/#search%7Cga%7C1%7Cg%3A%22com.twitter%22%20AND%20a%3A%22finatra-http-server_2.12%22">finatra-http-server</a> library. We also recommend using <a class="reference external" href="https://logback.qos.ch/">Logback</a> as your <a class="reference external" href="https://www.slf4j.org/manual.html">SLF4J</a> implementation. E.g.,</p>
<p>with sbt:</p>
<pre class="literal-block">&quot;com.twitter&quot; %% &quot;finatra-http-server&quot; % &quot;24.2.0&quot;,
&quot;ch.qos.logback&quot; % &quot;logback-classic&quot; % versions.logback,</pre>
<p>For more information on logging with Finatra see: <a class="reference external" href="../logging/index.html#introduction-to-logging-with-finatra">Introduction to Logging With Finatra</a>.</p>
<p>Create a new class which extends <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/HttpServer.scala">c.t.finatra.http.HttpServer</a>:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">object</span> <span class="nc">ExampleServerMain</span> <span class="k">extends</span> <span class="nc">ExampleServer</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">???</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Or in Java, extend the <a class="reference external" href="https://github.com/twitter/finatra/blob/100b858ca2786199114247e1440a1bfb4a460b28/http-server/src/main/scala/com/twitter/finatra/http/servers.scala#L505">c.t.finatra.http.AbstractHttpServer</a>:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">com.twitter.app.Flaggable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.AbstractHttpServer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.routing.HttpRouter</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleServer</span> <span class="kd">extends</span> <span class="n">AbstractHttpServer</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="nf">ExampleServer</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">createFlag</span><span class="p">(</span>
      <span class="cm">/* name      = */</span> <span class="s">&quot;magic.number&quot;</span><span class="p">,</span>
      <span class="cm">/* default   = */</span> <span class="mi">55</span><span class="p">,</span>
      <span class="cm">/* help      = */</span> <span class="s">&quot;This is a magic number.&quot;</span><span class="p">,</span>
      <span class="cm">/* flaggable = */</span> <span class="n">Flaggable</span><span class="p">.</span><span class="na">ofJavaInteger</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">HttpRouter</span> <span class="n">router</span><span class="p">)</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>See the server <a class="reference external" href="#naming-convention">naming conventions</a> which is especially important for Java users.</p>
</div>
<p>A more complete example includes adding Modules, a Controller, and Filters. In Scala:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">google</span><span class="p">.</span><span class="nn">inject</span><span class="p">.</span><span class="nc">Module</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">filters</span><span class="p">.{</span><span class="nc">LoggingMDCFilter</span><span class="p">,</span> <span class="nc">TraceIdMDCFilter</span><span class="p">}</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">object</span> <span class="nc">ExampleServerMain</span> <span class="k">extends</span> <span class="nc">ExampleServer</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="kd">val</span> <span class="n">modules</span><span class="p">:</span> <span class="nc">Seq</span><span class="p">[</span><span class="nc">Module</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Seq</span><span class="p">(</span>
    <span class="nc">ExampleModule</span><span class="p">)</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">router</span>
      <span class="p">.</span><span class="n">filter</span><span class="p">[</span><span class="nc">LoggingMDCFilter</span><span class="p">[</span><span class="nc">Request</span><span class="p">,</span> <span class="nc">Response</span><span class="p">]]</span>
      <span class="p">.</span><span class="n">filter</span><span class="p">[</span><span class="nc">TraceIdMDCFilter</span><span class="p">[</span><span class="nc">Request</span><span class="p">,</span> <span class="nc">Response</span><span class="p">]]</span>
      <span class="p">.</span><span class="n">filter</span><span class="p">[</span><span class="nc">ExampleFilter</span><span class="p">]</span>
      <span class="p">.</span><span class="n">add</span><span class="p">[</span><span class="nc">ExampleController</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>in Java:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">com.google.inject.Module</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.google.inject.TypeLiteral</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.app.Flaggable</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.AbstractHttpServer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.routing.HttpRouter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.filters.LoggingMDCFilter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.filters.StatsFilter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.filters.TraceIdMDCFilter</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">scala.reflect.ManifestFactory</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleServer</span> <span class="kd">extends</span> <span class="n">AbstractHttpServer</span> <span class="p">{</span>

  <span class="kd">public</span> <span class="nf">ExampleServer</span><span class="p">()</span> <span class="p">{</span>
      <span class="n">createFlag</span><span class="p">(</span>
        <span class="cm">/* name      = */</span> <span class="s">&quot;magic.number&quot;</span><span class="p">,</span>
        <span class="cm">/* default   = */</span> <span class="mi">55</span><span class="p">,</span>
        <span class="cm">/* help      = */</span> <span class="s">&quot;This is a magic number.&quot;</span><span class="p">,</span>
        <span class="cm">/* flaggable = */</span> <span class="n">Flaggable</span><span class="p">.</span><span class="na">ofJavaInteger</span><span class="p">());</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span> <span class="nf">javaModules</span><span class="p">()</span> <span class="p">{</span>
      <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span>
        <span class="n">ExampleModule$</span><span class="p">.</span><span class="na">MODULE$</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">HttpRouter</span> <span class="n">httpRouter</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">httpRouter</span>
          <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="k">new</span> <span class="n">TypeLiteral</span><span class="o">&lt;</span><span class="n">LoggingMDCFilter</span><span class="o">&lt;</span><span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="o">&gt;&gt;</span><span class="p">(){})</span>
          <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">ManifestFactory</span><span class="p">.</span><span class="na">classType</span><span class="p">(</span><span class="n">TraceIdMDCFilter</span><span class="p">.</span><span class="na">class</span><span class="p">))</span>
          <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="k">new</span> <span class="n">TypeLiteral</span><span class="o">&lt;</span><span class="n">StatsFilter</span><span class="o">&lt;</span><span class="n">Request</span><span class="o">&gt;&gt;</span><span class="p">()</span> <span class="p">{})</span>
          <span class="p">.</span><span class="na">filter</span><span class="p">(</span><span class="n">ExampleFilter</span><span class="p">.</span><span class="na">class</span><span class="p">)</span>
          <span class="p">.</span><span class="na">add</span><span class="p">(</span><span class="n">ExampleController</span><span class="p">.</span><span class="na">class</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Take a look at the server <a class="reference external" href="#naming-convention">naming conventions</a> which is especially important for Java users.</p>
</div>
<p>Adding filters in Java can happen in multiple ways which is somewhat dependent on your tolerance to
type erasure if you need to apply Filters that have <a class="reference external" href="https://github.com/google/guice/wiki/FrequentlyAskedQuestions#how-to-inject-class-with-generic-type">parameterized types</a>.</p>
<p>Above, we show how you can choose to use the <cite>.filter(typeLiteral: TypeLiteral[T])</cite> method from the
<cite>HttpRouter</cite> which will obtain the Filter instance described by the <a class="reference external" href="https://github.com/google/guice/wiki/BuiltInBindings#typeliterals">TypeLiteral[T]</a>
and append it to the filter chain. There is a version which also accepts a <a class="reference external" href="../getting-started/binding_annotations.html">binding annotation</a>
which is useful if you need to construct a Filter that is not only parameterized but also discriminated
by a <a class="reference external" href="../getting-started/binding_annotations.html">binding annotation</a>. <strong>This is the recommended
way to configure generically typed Filters.</strong></p>
<p>Or you can choose to use the <a class="reference external" href="https://www.scala-lang.org/api/2.12.4/scala/reflect/ManifestFactory$.html">scala.reflect.ManifestFactory</a>
to pass the Manifest type for a Filter class. Note in the usage above, the <a class="reference external" href="https://twitter.github.io/finatra/scaladocs/com/twitter/finatra/http/filters/TraceIdMDCFilter.html">TraceIdMDCFilter</a>
has two type params, <cite>[Req,Rep]</cite>. They are not specified when building the Manifest which amounts
to the types being erased. In this case, this is OK since we are a.) appending the instance
to a chain which will adapt the types appropriately and b.) we don’t expect to obtain the Filter
instance from the injector anywhere else in the code (which would need to be asked for as just
<cite>TraceIdMDCFilter</cite> and not <cite>TraceIdMDCFilter[Request, Response]</cite>).</p>
<p>Finally, you can always pass the class of the Filter to append. The instance will be obtained from
the injector and appended to the filter chain.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Note: to add <a class="reference external" href="../getting-started/modules.html">Modules</a> to your Java server override the
<cite>javaModules()</cite> method.</p>
</div>
<p>Simplistically, a server can be thought of as a collection of <a class="reference external" href="controllers.html">controllers</a> composed with <a class="reference external" href="filters.html">filters</a>.
Additionally, a server can define <a class="reference external" href="../getting-started/modules.html">modules</a> for providing instances to the object graph and how to <a class="reference external" href="../http/exceptions.html">map exceptions</a> to HTTP responses.</p>
<section id="naming-convention">
<h2>Naming Convention<a class="headerlink" href="#naming-convention" title="Permalink to this headline">¶</a></h2>
<p>The Finatra convention for defining a server is to create a Scala <a class="reference external" href="https://twitter.github.io/scala_school/basics2.html#object">object</a>
with a name ending in “Main” that extends your server class. The server <em>class</em> can be used in
testing as this allows your server to be instantiated multiple times in tests without worrying about
static state persisting across test runs in the same JVM.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">object</span> <span class="nc">ExampleServerMain</span> <span class="k">extends</span> <span class="nc">ExampleServer</span>
</pre></div>
</div>
<p>The static object, e.g., <cite>ExampleServerMain</cite>, would then contain a static <cite>main()</cite> method for the server
to serve as the <a class="reference external" href="https://docs.oracle.com/javase/tutorial/deployment/jar/appman.html">application entry point</a>
for running the server in all other cases.</p>
<section id="java-naming-convention">
<h3>Java Naming Convention<a class="headerlink" href="#java-naming-convention" title="Permalink to this headline">¶</a></h3>
<p>Similarly, in Java the best practice is to create a separate “main” class which defines a Java <a class="reference external" href="https://docs.oracle.com/javase/tutorial/getStarted/application/index.html#MAIN">main()</a> method that accepts the Java <a class="reference external" href="https://docs.oracle.com/javase/tutorial/essential/environment/cmdLineArgs.html#:~:text=A%20Java%20application%20can%20accept,when%20the%20application%20is%20launched.&amp;text=When%20an%20application%20is%20launched,an%20array%20of%20String%20s.">command-line arguments</a> for flag parsing:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kd">public</span> <span class="kd">final</span> <span class="kd">class</span> <span class="nc">ExampleServerMain</span> <span class="p">{</span>
    <span class="kd">private</span> <span class="nf">ExampleServerMain</span><span class="p">()</span> <span class="p">{</span>
    <span class="p">}</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="p">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">new</span> <span class="n">ExampleServer</span><span class="p">().</span><span class="na">main</span><span class="p">(</span><span class="n">args</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <cite>ExampleServerMain</cite> would be the class used as the <a class="reference external" href="https://docs.oracle.com/javase/tutorial/deployment/jar/appman.html">application entry point</a>
for running the server.</p>
</section>
</section>
<section id="creating-an-https-server">
<h2>Creating an HTTPS Server<a class="headerlink" href="#creating-an-https-server" title="Permalink to this headline">¶</a></h2>
<p>Finatra provides a default for the <cite>defaultHttpPort</cite> of <cite>“:8888”</cite> which means that Finatra will
always attempt to start a non-ssl HTTP server on port <cite>8888</cite> if no other configuration is done. The
framework allows for users to specify starting an HTTPS server, either additionally or instead.</p>
<p>An HTTPS server can be started by passing in a value for the <cite>-https.port</cite> flag or overriding the
<cite>defaultHttpsPort</cite> with a non-empty value. To configure the underlying Finagle <cite>c.t.finagle.Http.Server</cite>
transport correctly, override the <cite>configureHttpsServer</cite> method in your HttpServer definition. E.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nc">Http</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">object</span> <span class="nc">ExampleHttpsServerMain</span> <span class="k">extends</span> <span class="nc">ExampleHttpsServer</span>

<span class="k">class</span> <span class="nc">ExampleHttpsServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="kd">val</span> <span class="n">defaultHttpsPort</span><span class="p">:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">&quot;:443&quot;</span>

  <span class="c1">// HTTP server configuration</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttpServer</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span><span class="p">):</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">server</span>
      <span class="p">.</span><span class="n">withResponseClassifier</span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
      <span class="p">.</span><span class="n">withMaxInitialLineSize</span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="c1">// HTTPS server configuration</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttpsServer</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span><span class="p">):</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">server</span>
      <span class="p">.</span><span class="n">withResponseClassifier</span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
      <span class="p">.</span><span class="n">withMaxInitialLineSize</span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
      <span class="p">.</span><span class="n">withTransport</span><span class="p">.</span><span class="n">tls</span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">router</span>
      <span class="p">.</span><span class="n">add</span><span class="p">[</span><span class="nc">ExampleController</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For convenience, a <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/Tls.scala">Tls</a>
trait is provided which encapsulates standard <a class="reference external" href="https://en.wikipedia.org/wiki/Transport_Layer_Security">TLS</a>
configuration for an HTTPS server. Thus you can also do:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nc">Http</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">Tls</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">object</span> <span class="nc">ExampleHttpsServerMain</span> <span class="k">extends</span> <span class="nc">ExampleHttpsServer</span>

<span class="k">class</span> <span class="nc">ExampleHttpsServer</span>
  <span class="k">extends</span> <span class="nc">HttpServer</span>
  <span class="k">with</span> <span class="nc">Tls</span> <span class="p">{</span>

  <span class="k">override</span> <span class="kd">val</span> <span class="n">defaultHttpsPort</span><span class="p">:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">&quot;:443&quot;</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">router</span>
      <span class="p">.</span><span class="n">add</span><span class="p">[</span><span class="nc">ExampleController</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<section id="disabling-the-default-http-server">
<h3>Disabling the Default HTTP Server<a class="headerlink" href="#disabling-the-default-http-server" title="Permalink to this headline">¶</a></h3>
<p>As mentioned, the above configuration will still attempt to start a non-ssl HTTP server. To disable
the non-ssl HTTP server, override the <cite>defaultHttpPort</cite> value to an empty String (and do not
pass a value for the <cite>-http.port</cite> flag), e.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nc">Http</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">Tls</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">object</span> <span class="nc">ExampleHttpsServerMain</span> <span class="k">extends</span> <span class="nc">ExampleHttpsServer</span>

<span class="k">class</span> <span class="nc">ExampleHttpsServer</span>
  <span class="k">extends</span> <span class="nc">HttpServer</span>
  <span class="k">with</span> <span class="nc">Tls</span> <span class="p">{</span>

  <span class="k">override</span> <span class="kd">val</span> <span class="n">defaultHttpPort</span><span class="p">:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">&quot;&quot;</span> <span class="c1">// disable the default HTTP port</span>
  <span class="k">override</span> <span class="kd">val</span> <span class="n">defaultHttpsPort</span><span class="p">:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">&quot;:443&quot;</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">router</span>
      <span class="p">.</span><span class="n">add</span><span class="p">[</span><span class="nc">ExampleController</span><span class="p">]</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</section>
</section>
<section id="serving-a-finagle-service-request-response">
<h2>Serving a Finagle <cite>Service[Request, Response]</cite><a class="headerlink" href="#serving-a-finagle-service-request-response" title="Permalink to this headline">¶</a></h2>
<p>You have the option to serve a manually constructed Finagle <cite>Service[Request, Response]</cite> instead of
creating an <a class="reference external" href="./controllers.html">HTTP Controller</a> and having the framework construct a
<cite>Service[Request, Response]</cite> via the <cite>HttpRouter</cite>.</p>
<p>To do so, extend the <cite>HttpServerTrait</cite> (or <cite>AbstractHttpServerTrait</cite> in Java) and implement the
<cite>httpService: Service[Request, Response]</cite> method:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">google</span><span class="p">.</span><span class="nn">inject</span><span class="p">.</span><span class="nc">Module</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nc">Service</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServerTrait</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">filters</span><span class="p">.{</span><span class="nc">LoggingMDCFilter</span><span class="p">,</span> <span class="nc">TraceIdMDCFilter</span><span class="p">}</span>

<span class="k">object</span> <span class="nc">ExampleServerMain</span> <span class="k">extends</span> <span class="nc">ExampleServer</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServerTrait</span> <span class="p">{</span>

  <span class="k">override</span> <span class="kd">val</span> <span class="n">modules</span><span class="p">:</span> <span class="nc">Seq</span><span class="p">[</span><span class="nc">Module</span><span class="p">]</span> <span class="o">=</span> <span class="nc">Seq</span><span class="p">(</span>
    <span class="nc">ExampleModule</span><span class="p">)</span>

  <span class="c1">// the `Service[Request, Response]` to serve</span>
  <span class="k">override</span> <span class="k">def</span> <span class="nf">httpService</span><span class="p">:</span> <span class="nc">Service</span><span class="p">[</span><span class="nc">Request</span><span class="p">,</span> <span class="nc">Response</span><span class="p">]</span> <span class="o">=</span> <span class="o">???</span>
<span class="p">}</span>
</pre></div>
</div>
<p>in Java:</p>
<div class="highlight-java notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">com.google.inject.Module</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finagle.Service</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finagle.Request</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finagle.Response</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">com.twitter.finatra.http.AbstractHttpServer</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collections</span><span class="p">;</span>
<span class="kn">import</span> <span class="nn">java.util.Collection</span><span class="p">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">ExampleServer</span> <span class="kd">extends</span> <span class="n">AbstractHttpServer</span> <span class="p">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Collection</span><span class="o">&lt;</span><span class="n">Module</span><span class="o">&gt;</span> <span class="nf">javaModules</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">Collections</span><span class="p">.</span><span class="na">singletonList</span><span class="p">(</span><span class="n">ExampleModule$</span><span class="p">.</span><span class="na">MODULE$</span><span class="p">);</span>
  <span class="p">}</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="n">Service</span><span class="o">&lt;</span><span class="n">Request</span><span class="p">,</span> <span class="n">Response</span><span class="o">&gt;</span> <span class="nf">httpService</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// the `Service&lt;Request, Response&gt;` to serve</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition important">
<p class="admonition-title">Important</p>
<p>The <cite>HttpRouter</cite> exposes a DSL for users which the framework uses to construct a filtered
<cite>Service[Request, Response]</cite>.</p>
<p>Note, you must choose one or the other: either implement your service with a
<a class="reference external" href="./controllers.html">Controller</a> added via the <cite>HttpRouter</cite> <strong>or</strong> serve a manually
constructed Finagle <cite>Service[Request, Response]</cite>.</p>
</div>
</section>
<section id="override-default-behavior">
<h2>Override Default Behavior<a class="headerlink" href="#override-default-behavior" title="Permalink to this headline">¶</a></h2>
<section id="flags">
<h3>Flags<a class="headerlink" href="#flags" title="Permalink to this headline">¶</a></h3>
<p>Some deployment environments may make it difficult to set <a class="reference external" href="../getting-started/flags.html">Flag values</a> with command line arguments. If this is the case, Finatra’s <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/HttpServer.scala">HttpServer</a>’s
core flags can be set from code.</p>
<p>For example, instead of setting the <cite>-http.port</cite> flag, you can override the following method in your server.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="kd">val</span> <span class="n">defaultHttpPort</span><span class="p">:</span> <span class="nc">String</span> <span class="o">=</span> <span class="s">&quot;:8080&quot;</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">...</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For a list of what flags can be set programmatically, please see the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/servers.scala">HttpServerTrait</a> class.</p>
</section>
<section id="framework-modules">
<h3>Framework Modules<a class="headerlink" href="#framework-modules" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/servers.scala">HttpServer</a>
provides some base configurations in the form of <a class="reference external" href="../getting-started/modules.html">modules</a> added
by default to a server’s object graph. This includes:</p>
<ul class="simple">
<li><p>the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/utils/src/main/scala/com/twitter/finatra/modules/FileResolverModule.scala">FileResolverModule</a> (see: <a class="reference external" href="../files/index.html">Working With Files</a>)</p></li>
<li><p>the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/modules/ExceptionManagerModule.scala">ExceptionManagerModule</a> (see: <a class="reference external" href="./exceptions.html">HTTP Exception Mapping</a>)</p></li>
<li><p>an <a class="reference external" href="https://github.com/twitter/finatra/blob/356f242a8b9a340374646ae577efa99f132125cb/http/src/main/scala/com/twitter/finatra/http/servers.scala#L363">overridable</a> default <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/modules/HttpResponseClassifierModule.scala">HttpResponseClassifierModule</a> (see: <a class="reference external" href="#id2">Server-side Response Classification</a>)</p></li>
<li><p>an <a class="reference external" href="https://github.com/twitter/finatra/blob/356f242a8b9a340374646ae577efa99f132125cb/http/src/main/scala/com/twitter/finatra/http/servers.scala#L508">overridable</a> default <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/modules/AccessLogModule.scala">AccessLogModule</a></p></li>
<li><p>an <a class="reference external" href="https://github.com/twitter/finatra/blob/356f242a8b9a340374646ae577efa99f132125cb/http/src/main/scala/com/twitter/finatra/http/servers.scala#L526">overridable</a> default <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala">ScalaObjectMapperModule</a> (see: <a class="reference external" href="../json/index.html">Jackson Integration</a>)</p></li>
<li><p>an <a class="reference external" href="https://github.com/twitter/finatra/blob/bfb6e22c9260eb3150b6768d6628ee6b3498183c/http/src/main/scala/com/twitter/finatra/http/servers.scala#L539">overridable</a> default <a class="reference external" href="https://github.com/twitter/finatra/blob/bfb6e22c9260eb3150b6768d6628ee6b3498183c/validation/src/main/scala/com/twitter/finatra/validation/ValidatorModule.scala">ValidatorModule</a> (see: <a class="reference external" href="../validation/index.html">Validation Framework</a>)</p></li>
<li><p>an <a class="reference external" href="https://github.com/twitter/finatra/blob/356f242a8b9a340374646ae577efa99f132125cb/http/src/main/scala/com/twitter/finatra/http/servers.scala#L519">overridable</a> default <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/modules/MessageBodyModule.scala">MessageBodyManagerModule</a> (see: <a class="reference external" href="./message_body.html">Message Body Components</a>)</p></li>
</ul>
<p>As expressed above, some of the <a class="reference external" href="../getting-started/modules.html">modules</a> provided in the <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/servers.scala">HttpServer</a>
are overridable. An example use-case would be to provide a custom <cite>ScalaObjectMapperModule</cite>
implementation in place of the default <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/jackson/src/main/scala/com/twitter/finatra/jackson/modules/ScalaObjectMapperModule.scala">ScalaObjectMapperModule</a></p>
<p>To do so you would override the <cite>protected def jacksonModule</cite> in your server with your custom
implementation.</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">fasterxml</span><span class="p">.</span><span class="nn">jackson</span><span class="p">.</span><span class="nn">databind</span><span class="p">.</span><span class="nc">PropertyNamingStrategy</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">jackson</span><span class="p">.</span><span class="nn">modules</span><span class="p">.</span><span class="nc">ScalaObjectMapperModule</span>

<span class="k">object</span> <span class="nc">MyCustomJacksonModule</span> <span class="k">extends</span> <span class="nc">ScalaObjectMapperModule</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">val</span> <span class="n">propertyNamingStrategy</span><span class="p">:</span> <span class="nc">PropertyNamingStrategy</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">PropertyNamingStrategy</span><span class="p">.</span><span class="nc">KebabCaseStrategy</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">jacksonModule</span> <span class="o">=</span> <span class="nc">MyCustomJacksonModule</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">???</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>If your module is defined as a class, you would pass an instance of the
class, e.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">fasterxml</span><span class="p">.</span><span class="nn">jackson</span><span class="p">.</span><span class="nn">databind</span><span class="p">.</span><span class="nc">PropertyNamingStrategy</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">jackson</span><span class="p">.</span><span class="nn">modules</span><span class="p">.</span><span class="nc">ScalaObjectMapperModule</span>

<span class="k">class</span> <span class="nc">MyCustomJacksonModule</span> <span class="k">extends</span> <span class="nc">ScalaObjectMapperModule</span> <span class="p">{</span>
  <span class="k">override</span> <span class="kd">val</span> <span class="n">propertyNamingStrategy</span><span class="p">:</span> <span class="nc">PropertyNamingStrategy</span> <span class="o">=</span>
      <span class="k">new</span> <span class="nc">PropertyNamingStrategy</span><span class="p">.</span><span class="nc">KebabCaseStrategy</span>
<span class="p">}</span>

<span class="p">...</span>

<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">jacksonModule</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">MyCustomJacksonModule</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">???</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Modules are de-duplicated before being installed to create the Injector. If a Framework
Module is also configured in the server’s <a class="reference external" href="../getting-started/modules.html#module-configuration-in-servers">list of Modules</a>,
the Framework Module will be replaced.</p>
</div>
</section>
<section id="finagle-server-configuration">
<h3>Finagle Server Configuration<a class="headerlink" href="#finagle-server-configuration" title="Permalink to this headline">¶</a></h3>
<p>If you want to further configure the underlying <a class="reference external" href="https://github.com/twitter/finagle">Finagle</a> server you can override <cite>configureHttpServer</cite> (or <cite>configureHttpsServer</cite>)
in your server to specify additional configuration on (or override the default configuration of) the underlying Finagle server.</p>
<p>For example:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finagle</span><span class="p">.</span><span class="nc">Http</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttp</span><span class="p">(</span><span class="n">router</span><span class="p">:</span> <span class="nc">HttpRouter</span><span class="p">):</span> <span class="nc">Unit</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">???</span>
  <span class="p">}</span>

  <span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttpServer</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span><span class="p">):</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">server</span>
      <span class="p">.</span><span class="n">withMaxRequestSize</span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
      <span class="p">.</span><span class="n">withAdmissionControl</span><span class="p">.</span><span class="n">concurrencyLimit</span><span class="p">(</span>
        <span class="n">maxConcurrentRequests</span> <span class="o">=</span> <span class="o">???</span><span class="p">,</span>
        <span class="n">maxWaiters</span> <span class="o">=</span> <span class="o">???</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>For more information on <a class="reference external" href="https://github.com/twitter/finagle">Finagle</a> server configuration see the documentation <a class="reference external" href="https://twitter.github.io/finagle/guide/Configuration.html">here</a>;
specifically the server documentation <a class="reference external" href="https://twitter.github.io/finagle/guide/Servers.html">here</a>.</p>
</section>
<section id="id3">
<h3>Server-side Response Classification<a class="headerlink" href="#id3" title="Permalink to this headline">¶</a></h3>
<p>The default Response Classifier for HTTP servers is <a class="reference external" href="https://github.com/twitter/finatra/blob/8b448065f5f74c1eedd744bd15618cbf932ea1bc/http/src/main/scala/com/twitter/finatra/http/response/HttpResponseClassifier.scala#L15">HttpResponseClassifier.ServerErrorsAsFailures</a>,
which classifies any HTTP 5xx response code as a failure. To configure server-side <a class="reference external" href="https://twitter.github.io/finagle/guide/Servers.html#response-classification">Response Classification</a> you could choose to
set the classifier directly on the underlying Finagle server by overriding the <cite>configureHttpServer</cite> (or <cite>configureHttpsServer</cite>) in your server, e.g.,</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">override</span> <span class="k">def</span> <span class="nf">configureHttpServer</span><span class="p">(</span><span class="n">server</span><span class="p">:</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span><span class="p">):</span> <span class="nc">Http</span><span class="p">.</span><span class="nc">Server</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">server</span><span class="p">.</span><span class="n">withResponseClassifier</span><span class="p">(</span><span class="o">???</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
</div>
<p>However, since the server-side ResponseClassifier could affect code not just at the Finagle level, we actually recommend overriding the specific <a class="reference external" href="#framework-modules">framework module</a>,
<cite>HttpResponseClassifierModule</cite> instead. This binds an instance of an <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/response/HttpResponseClassifier.scala">HttpResponseClassifier</a>
to the object graph that is then available to be injected into things like the HTTP <a class="reference external" href="https://github.com/twitter/finatra/blob/develop/http-server/src/main/scala/com/twitter/finatra/http/filters/StatsFilter.scala">StatsFilter</a>
for a more accurate reporting of metrics that takes into account server-side response classification.</p>
<p>For example, in your <cite>HttpServer</cite> you would do:</p>
<div class="highlight-scala notranslate"><div class="highlight"><pre><span></span><span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">google</span><span class="p">.</span><span class="nn">inject</span><span class="p">.</span><span class="nc">Module</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nc">HttpServer</span>
<span class="k">import</span> <span class="nn">com</span><span class="p">.</span><span class="nn">twitter</span><span class="p">.</span><span class="nn">finatra</span><span class="p">.</span><span class="nn">http</span><span class="p">.</span><span class="nn">routing</span><span class="p">.</span><span class="nc">HttpRouter</span>

<span class="k">class</span> <span class="nc">ExampleServer</span> <span class="k">extends</span> <span class="nc">HttpServer</span> <span class="p">{</span>

  <span class="k">override</span> <span class="n">httpResponseClassifierModule</span><span class="p">:</span> <span class="nc">Module</span> <span class="o">=</span> <span class="o">???</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The bound value is also then set on the underlying Finagle server before serving.</p>
</section>
</section>
<section id="testing">
<h2>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">¶</a></h2>
<p>For information on testing an HTTP server see the HTTP Server <a class="reference external" href="../testing/feature_tests.html#http-server">Feature Tests</a> section.</p>
</section>
</section>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/finatra_logo.png" alt="Logo"/>
            </a></p><p>
  <a href="https://github.com/twitter/finatra">Finatra</a> is a Scala services framework built on top of <a href="https://twitter.github.io/twitter-server/">TwitterServer</a> and <a href="https://twitter.github.io/finagle/">Finagle</a>.
</p>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://twitter.github.io/finatra/user-guide">User's&nbsp;Guide</a></li>
  <li><a href="https://finagle.github.io/blog/">Finagle&nbsp;Blog</a></li>
  <li><a href="https://github.com/twitter/finatra">Finatra&nbsp;on&nbsp;Github</a></li>
  <li><a href="https://github.com/twitter/finatra/issues">Github&nbsp;Issues</a></li>
</ul>
  <h3><a href="../../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">HTTP Server Definition</a><ul>
<li><a class="reference internal" href="#naming-convention">Naming Convention</a><ul>
<li><a class="reference internal" href="#java-naming-convention">Java Naming Convention</a></li>
</ul>
</li>
<li><a class="reference internal" href="#creating-an-https-server">Creating an HTTPS Server</a><ul>
<li><a class="reference internal" href="#disabling-the-default-http-server">Disabling the Default HTTP Server</a></li>
</ul>
</li>
<li><a class="reference internal" href="#serving-a-finagle-service-request-response">Serving a Finagle <cite>Service[Request, Response]</cite></a></li>
<li><a class="reference internal" href="#override-default-behavior">Override Default Behavior</a><ul>
<li><a class="reference internal" href="#flags">Flags</a></li>
<li><a class="reference internal" href="#framework-modules">Framework Modules</a></li>
<li><a class="reference internal" href="#finagle-server-configuration">Finagle Server Configuration</a></li>
<li><a class="reference internal" href="#id3">Server-side Response Classification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#testing">Testing</a></li>
</ul>
</li>
</ul>
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">User’s Guide</a><ul>
      <li>Previous: <a href="../twitter-server/stats_receiver.html" title="previous chapter">How to properly configure the server <cite>StatsReceiver</cite></a></li>
      <li>Next: <a href="controllers.html" title="next chapter">Defining HTTP Controllers</a></li>
  </ul></li>
  </ul></li>
</ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Search the contents of this site.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  
    <div class="github-fork-ribbon-wrapper right fixed" style="width: 150px;height: 150px;position: fixed;overflow: hidden;top: 0;z-index: 9999;pointer-events: none;right: 0;"><div class="github-fork-ribbon" style="position: absolute;padding: 2px 0;background-color: #900;background-image: linear-gradient(to bottom, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.15));-webkit-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);-moz-box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);box-shadow: 0 2px 3px 0 rgba(0, 0, 0, 0.5);z-index: 9999;pointer-events: auto;top: 42px;right: -43px;-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);-ms-transform: rotate(45deg);-o-transform: rotate(45deg);transform: rotate(45deg);"><a target="_blank" href="https://github.com/twitter/finatra" style="font: 700 13px &quot;Helvetica Neue&quot;, Helvetica, Arial, sans-serif;color: #fff;text-decoration: none;text-shadow: 0 -1px rgba(0, 0, 0, 0.5);text-align: center;width: 200px;line-height: 20px;display: inline-block;padding: 2px 0;border-width: 1px 0;border-style: dotted;border-color: rgba(255, 255, 255, 0.7);">Fork me on GitHub</a></div></div>
  

  <div class="footer">
    &copy; Copyright 2024 Twitter, Inc.
    Created using <a href="http://sphinx.pocoo.org/">Sphinx</div>
  
  </body>
</html>